---
const { data } = Astro.props;
// 处理页码
import { fmtPage } from "@/utils/index";
// 翻页组件样式
import "./Pagination.less";

// 生成显示的页码数组
const currentPageNum = fmtPage(data.current) || "1";
const currentPage = parseInt(currentPageNum);

// 计算总页数：如果有 last，用 last；否则根据 prev/next 推断
let totalPages = currentPage;
if (data.last) {
	totalPages = parseInt(fmtPage(data.last) || "1");
} else if (data.next) {
	// 如果有下一页但没有 last，说明至少还有一页
	totalPages = currentPage + 1;
} else if (data.first) {
	// 如果有 first 但没有 next，说明当前页是最后一页
	totalPages = currentPage;
}

// 如果当前在最后一页且没有 last 属性，尝试从 prev 推断
if (!data.next && data.prev && !data.last) {
	// 最后一页的情况
	totalPages = currentPage;
}

// 生成要显示的页码列表
const pageNumbers: Array<{num: number, url: string}> = [];
for (let i = 1; i <= totalPages; i++) {
	const url = i === 1 ? "/" : `/${i}`;
	pageNumbers.push({ num: i, url });
}
---

<section class="vh-art-page">
	<!-- 上一页 -->
	<a class={`vh-pagination-item${!data.prev ? " disabled" : ""}`} href={data.prev || "javascript:;"} title="上一页">
		<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M15 6l-6 6l6 6"></path></svg>
	</a>
	
	<!-- 所有页码 -->
	{pageNumbers.map((page) => (
		<a 
			class={`vh-pagination-item${page.num === currentPage ? " active" : ""}`} 
			href={page.num === currentPage ? "javascript:;" : page.url} 
			title={`第${page.num}页`}
		>
			{page.num}
		</a>
	))}
	
	<!-- 下一页 -->
	<a class={`vh-pagination-item${!data.next ? " disabled" : ""}`} href={data.next || "javascript:;"} title="下一页">
		<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 6l6 6l-6 6"></path></svg>
	</a>
</section>
