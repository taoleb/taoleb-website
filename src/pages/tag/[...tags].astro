---
import { getCollection } from "astro:content";
import moveTopToFirst from "@/utils/moveTopToFirst";
export async function getStaticPaths(): Promise<any> {
	const posts = await getCollection("blog");
	let tagList: any = [];
	posts.forEach(post => (tagList = [...tagList, ...(post.data.tags || [])]));
	return [...new Set(tagList)].map(tags => ({ params: { tags } }));
}
// è·å–æ ‡ç­¾ä¸‹çš„æ–‡ç« 
const { tags } = Astro.params;
const allPosts = await getCollection("blog");
const tagPosts = allPosts.filter(post => post.data.tags && post.data.tags.includes(tags) && !post.data.hide);
const sortedPosts = tagPosts.sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());
const finalPosts = moveTopToFirst(sortedPosts);

// é¡µé¢ Info
import SITE_CONFIG from "@/config";
const { Description } = SITE_CONFIG;
// å…¬å…± Layout
import Layout from "@/layouts/Layout/Layout.astro";
// æ–‡ç« å¡ç‰‡ç»„ä»¶
import ArticleCard from "@/components/ArticleCard/ArticleCard.astro";
---

<Layout title={`æ ‡ç­¾ ${tags} ä¸‹çš„æ–‡ç« `} description={Description}>
	<section class="vh-tools-main vh-animation vh-animation-init">
		<header class="vh-page-header">
			<h1>æ ‡ç­¾ï¼š{tags} ğŸ·ï¸</h1>
			<p>å…± {finalPosts.length} ç¯‡æ–‡ç« </p>
		</header>
		<main class="article-list-main">
			<section class="article-list">
				<!-- æ–‡ç« åˆ—è¡¨ -->
				{finalPosts.map((post, index) => <ArticleCard post={post} index={index} />)}
			</section>
		</main>
	</section>
</Layout>
